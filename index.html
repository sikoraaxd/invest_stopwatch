<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Денежный секундомер</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121a33;
      --panel-2: #0f1630;
      --text: #e9eefb;
      --muted: #9fb0d1;
      --accent: #6ea8fe;
      --accent-2: #4fd1c5;
      --danger: #ef4444;
      --ok: #22c55e;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    html, body { height: 100%; }
    body {
      margin: 0; background: radial-gradient(1200px 800px at 10% -10%, #1b2552 0%, var(--bg) 55%);
      color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      display: grid; place-items: center; padding: 24px;
    }
    .app { width: min(1050px, 100%); }
    .grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 24px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    .card { background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%); border-radius: var(--radius); box-shadow: var(--shadow); padding: 20px; border: 1px solid rgba(255,255,255,.06); }
    .title { font-size: clamp(18px, 2.2vw, 22px); letter-spacing: .3px; color: var(--muted); margin: 0 0 12px; }

    .big { font-variant-numeric: tabular-nums; font-size: clamp(38px, 7vw, 64px); line-height: 1.1; font-weight: 800; letter-spacing: .5px; }
    .currency { opacity: .9; font-weight: 700; margin-left: .15em; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    @media (max-width: 540px) { .row { grid-template-columns: 1fr; } }

    label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    .input { width: 100%; box-sizing: border-box; background: #0b1430; border: 1px solid rgba(255,255,255,.08); color: var(--text); padding: 12px 14px; border-radius: 12px; outline: none; font-size: 16px; }
    .input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(110,168,254,.15); }
    .suffix { display: flex; align-items: center; gap: 10px; }
    .suffix span { font-size: 14px; color: var(--muted); }

    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button { cursor: pointer; border: none; padding: 12px 16px; border-radius: 12px; font-weight: 700; letter-spacing: .2px; }
    .primary { background: linear-gradient(180deg, #2f66ff, #2252cc); color: white; }
    .ghost { background: transparent; color: var(--text); border: 1px solid rgba(255,255,255,.12); }
    .danger { background: linear-gradient(180deg, #ef4444, #c03636); color: white; }
    .ok { background: linear-gradient(180deg, #22c55e, #1f9e4c); color: white; }

    .muted { color: var(--muted); font-size: 14px; }
    .stats { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; margin-top: 16px; }
    @media (max-width: 600px) { .stats { grid-template-columns: 1fr; } }
    .stat { background: rgba(255,255,255,.03); padding: 12px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.06); }
    .stat .k { color: var(--muted); font-size: 12px; }
    .stat .v { font-variant-numeric: tabular-nums; font-weight: 700; }

    .warn { color: #fbbf24; font-size: 13px; display: none; }

    .eta { margin-top: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    @media (max-width: 700px) { .eta { grid-template-columns: 1fr; } }
    .eta .it { background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.06); border-radius: 12px; padding: 10px 12px; }
    .eta .it .lbl { font-size: 12px; color: var(--muted); }
    .eta .it .val { font-variant-numeric: tabular-nums; font-weight: 700; }

    .foot { margin-top: 10px; font-size: 12px; color: var(--muted); }
    .chip { display: inline-flex; gap: 8px; align-items: center; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.05); font-size: 12px; }
    .chip .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--ok); box-shadow: 0 0 12px rgba(34,197,94,.7); }
    .chip.paused .dot { background: var(--danger); box-shadow: 0 0 12px rgba(239,68,68,.6); }
      /* Плашки прогноза (в день/месяц/год) */
    .payout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 6px; }
    @media (max-width: 700px) { .payout { grid-template-columns: 1fr; } }
    .payout .item { background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.06); border-radius: 12px; padding: 12px; }
    .payout .item .lbl { font-size: 12px; color: var(--muted); }
    .payout .item .val { font-variant-numeric: tabular-nums; font-weight: 700; }
  </style>
</head>
<body>
  <div class="app">
    <div class="grid">
      <section class="card" aria-live="polite">
        <p class="title">Всего начислено с запуска</p>
        <div class="big" id="earnedDisplay">0,00<span class="currency">₽</span></div>
        <div class="stats">
          <div class="stat">
            <div class="k">Скорость в секунду</div>
            <div class="v" id="perSec">—</div>
          </div>
          <div class="stat">
            <div class="k">Скорость в час / день</div>
            <div class="v" id="perHourDay">—</div>
          </div>
        </div>
        <p class="title" style="margin-top:12px">Доход при текущих настройках</p>
        <div class="payout">
          <div class="item"><div class="lbl">В день</div><div class="val" id="outPerDay">—</div></div>
          <div class="item"><div class="lbl">В месяц (30 дн.)</div><div class="val" id="outPerMonth">—</div></div>
          <div class="item"><div class="lbl">В год</div><div class="val" id="outPerYear">—</div></div>
        </div>
        <div class="eta">
          <div class="it"><div class="lbl">До +1 ₽</div><div class="val" id="eta1">—</div></div>
          <div class="it"><div class="lbl">До +100 ₽</div><div class="val" id="eta100">—</div></div>
          <div class="it"><div class="lbl">До +1000 ₽</div><div class="val" id="eta1000">—</div></div>
        </div>
        <div class="foot">
          <span id="runChip" class="chip"><span class="dot"></span><span id="runText">Идёт</span></span>
          <span style="margin-left:10px" id="dirtyFlag" class="warn">Есть несохранённые изменения — нажмите «Применить».</span>
        </div>
      </section>

      <section class="card">
        <p class="title">Настройки начисления (простые проценты)</p>
        <div class="row">
          <div>
            <label for="capital">Капитал, ₽</label>
            <input class="input" id="capital" type="number" inputmode="decimal" min="0" step="0.01" value="0" />
          </div>
          <div class="suffix">
            <div style="flex:1">
              <label for="apr">Ставка, % годовых</label>
              <input class="input" id="apr" type="number" inputmode="decimal" min="0" step="0.0001" value="0" />
            </div>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <div>
            <label for="basis">Годовая база</label>
            <select id="basis" class="input">
              <option value="365" selected>365 дней</option>
              <option value="366">366 (високосный)</option>
              <option value="360">360 (банковская)</option>
            </select>
          </div>
          <div>
            <label for="precision">Точность отображения</label>
            <select id="precision" class="input">
              <option value="2" selected>2 знака (копейки)</option>
              <option value="4">4 знака</option>
              <option value="6">6 знаков</option>
            </select>
          </div>
        </div>

        <div class="btns" style="margin-top:16px">
          <button id="apply" class="primary">Применить</button>
          <button id="pause" class="ghost">Пауза</button>
          <button id="reset" class="danger" title="Сбросить накопленную сумму в ноль">Сброс</button>
        </div>
        <p class="muted" style="margin-top:10px">Изменения ставки/капитала начнут действовать только после нажатия «Применить». Накопленная сумма <strong>не сбрасывается</strong>.</p>
      </section>
    </div>
  </div>

  <script>
    // ======= ЛОГИКА СЕКУНДОМЕРА (простые проценты, без капитализации) =======
    const els = {
      earned: document.getElementById('earnedDisplay'),
      perSec: document.getElementById('perSec'),
      perHourDay: document.getElementById('perHourDay'),
      eta1: document.getElementById('eta1'),
      eta100: document.getElementById('eta100'),
      eta1000: document.getElementById('eta1000'),
      outPerDay: document.getElementById('outPerDay'),
      outPerMonth: document.getElementById('outPerMonth'),
      outPerYear: document.getElementById('outPerYear'),
      runChip: document.getElementById('runChip'),
      runText: document.getElementById('runText'),
      dirtyFlag: document.getElementById('dirtyFlag'),
      // inputs
      cap: document.getElementById('capital'),
      apr: document.getElementById('apr'),
      basis: document.getElementById('basis'),
      precision: document.getElementById('precision'),
      // buttons
      apply: document.getElementById('apply'),
      pause: document.getElementById('pause'),
      reset: document.getElementById('reset'),
    };

    let capital = 0;
    let apr = 0; // %
    let basis = parseInt(els.basis.value, 10) || 365; // дней в году

    let running = true;
    let dirty = false;
    let last = performance.now(); // ms
    let acc = 0; // накоплено с момента запуска (в валюте)

    // текущая скорость, ₽/сек
    let ratePerSec = computePerSec(capital, apr, basis);

    function computePerSec(cap, aprPct, basisDays) {
      const r = Math.max(0, aprPct) / 100;
      const secondsInYear = basisDays * 24 * 3600;
      return Math.max(0, cap) * r / secondsInYear;
    }

    // Корректное чтение числа из <input type="number"> c учётом запятой/пробелов
    function readNumber(inputEl) {
      const v = inputEl.valueAsNumber;
      if (Number.isFinite(v)) return v;
      const s = (inputEl.value || '').toString().replace(/\s/g, '').replace(',', '.');
      const n = parseFloat(s);
      return Number.isFinite(n) ? n : 0;
    }

    function formatMoney(num, frac=2) {
      const opts = { style: 'currency', currency: 'RUB', minimumFractionDigits: frac, maximumFractionDigits: frac };
      return new Intl.NumberFormat('ru-RU', opts).format(num);
    }

    function formatRate(num, frac=6) {
      return new Intl.NumberFormat('ru-RU', { minimumFractionDigits: frac, maximumFractionDigits: frac }).format(num) + ' ₽/с';
    }

    function formatShort(num, frac=2) {
      return new Intl.NumberFormat('ru-RU', { minimumFractionDigits: frac, maximumFractionDigits: frac }).format(num);
    }

    function formatDuration(totalSeconds) {
      if (!isFinite(totalSeconds) || totalSeconds < 0) return '—';
      const s = Math.floor(totalSeconds);
      const days = Math.floor(s / 86400);
      const r1 = s % 86400;
      const hh = Math.floor(r1 / 3600);
      const r2 = r1 % 3600;
      const mm = Math.floor(r2 / 60);
      const ss = r2 % 60;
      const pad = n => String(n).padStart(2, '0');
      return (days>0? days + 'д ' : '') + pad(hh) + ':' + pad(mm) + ':' + pad(ss);
    }

    function finalizeAcc() {
      const now = performance.now();
      if (running) {
        const dt = (now - last) / 1000; // сек
        if (dt > 0) acc += dt * ratePerSec;
      }
      last = now;
    }

    function applySettings() {
      finalizeAcc(); // зафиксировать начисления по прежней скорости
      capital = readNumber(els.cap);
      apr = readNumber(els.apr);
      basis = parseInt(els.basis.value, 10) || 365;
      ratePerSec = computePerSec(capital, apr, basis);
      dirty = false;
      els.dirtyFlag.style.display = 'none';
      updateSpeedBlocks();
    }

    function updateSpeedBlocks() {
      const frac = parseInt(els.precision.value, 10) || 2;
      els.perSec.textContent = formatRate(ratePerSec, Math.min(frac, 8));
      const perHour = ratePerSec * 3600;
      const perDay = ratePerSec * 86400;
      const perMonth = perDay * 30; // месяц считаем как 30 дней
      const perYear = ratePerSec * basis * 86400; // эквивалентно capital * apr/100
      els.perHourDay.textContent = `${formatShort(perHour, 2)} ₽/ч · ${formatShort(perDay, 2)} ₽/д`;
      // Прогнозные суммы
      if (els.outPerDay) {
        els.outPerDay.textContent = `${formatShort(perDay, frac)} ₽`;
        els.outPerMonth.textContent = `${formatShort(perMonth, frac)} ₽`;
        els.outPerYear.textContent = `${formatShort(perYear, frac)} ₽`;
      }
      // ETA до целей, с учётом уже накопленного
      els.eta1.textContent = ratePerSec > 0 ? formatDuration((1 - acc) / ratePerSec) : '—';
      els.eta100.textContent = ratePerSec > 0 ? formatDuration((100 - acc) / ratePerSec) : '—';
      els.eta1000.textContent = ratePerSec > 0 ? formatDuration((1000 - acc) / ratePerSec) : '—';
    }

    function render() {
      const frac = parseInt(els.precision.value, 10) || 2;
      els.earned.innerHTML = `${formatShort(acc, frac)}<span class="currency">₽</span>`;
      // обновить ETA динамически
      if (ratePerSec > 0) {
        els.eta1.textContent = formatDuration((1 - acc) / ratePerSec);
        els.eta100.textContent = formatDuration((100 - acc) / ratePerSec);
        els.eta1000.textContent = formatDuration((1000 - acc) / ratePerSec);
      }
    }

    function loop(ts) {
      if (running) {
        const dt = (ts - last) / 1000;
        if (dt > 0) {
          acc += dt * ratePerSec;
          last = ts;
          render();
        } else {
          last = ts; // на случай рывков
        }
      }
      requestAnimationFrame(loop);
    }

    // Инициализация
    updateSpeedBlocks();
    render();
    requestAnimationFrame(t => { last = t; requestAnimationFrame(loop); });

    // Слушатели
    [els.cap, els.apr, els.basis].forEach(inp => {
      inp.addEventListener('input', () => { dirty = true; els.dirtyFlag.style.display = 'inline'; });
    });
    els.precision.addEventListener('change', () => { updateSpeedBlocks(); render(); });

    els.apply.addEventListener('click', applySettings);

    els.pause.addEventListener('click', () => {
      if (running) { finalizeAcc(); }
      running = !running;
      els.pause.textContent = running ? 'Пауза' : 'Продолжить';
      els.runText.textContent = running ? 'Идёт' : 'На паузе';
      els.runChip.classList.toggle('paused', !running);
      last = performance.now();
    });

    els.reset.addEventListener('click', () => {
      if (!confirm('Сбросить накопленную сумму в ноль?')) return;
      finalizeAcc();
      acc = 0;
      render();
    });

    // Подсказка: здесь могла бы быть капитализация. Для простоты её нет.
    // Если понадобится — можно реализовать «непрерывную» капитализацию по сегментам.
  </script>
</body>
</html>
